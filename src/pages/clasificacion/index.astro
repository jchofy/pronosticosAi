---
// @ts-nocheck
import Base from '../../layouts/Base.astro';
import { getLeagues } from '../../lib/leagues.js';
import { metaBasic } from '../../lib/seo.js';
import { SITE_URL } from '../../lib/env.js';

let leagues = [];
let error = null;
try {
  leagues = await getLeagues();
} catch (e) {
  error = 'Service unavailable';
  Astro.response.status = 503;
}

const meta = metaBasic('Clasificaci贸n por liga', 'Explora la clasificaci贸n de todas las ligas disponibles.', `${SITE_URL}/clasificacion`);
---
<Base { ...meta }>
  <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight mb-6">Clasificaci贸n por liga</h1>
  { error ? (
    <div class="card p-6 text-red-600">{error}</div>
  ) : (
    <ul class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {leagues.map((l) => {
        const resolve = (p) => p ? `/${String(p).replace(/^\/?.*public\//,'').replace(/^\//,'')}` : null;
        const logo = resolve(l.league_logo);
        return (
          <li class="card p-4 sm:p-5 hover:shadow-md transition">
            <div class="flex items-center gap-3">
              {logo && <img src={logo} alt={l.name} class="h-10 w-10 rounded-md bg-white object-contain p-1" width="40" height="40" loading="lazy" decoding="async" />}
              <div class="min-w-0">
                <p class="font-semibold truncate">{l.name}</p>
                <p class="text-xs text-gray-600 truncate">{l.country}</p>
              </div>
            </div>
            <div class="mt-3 grid grid-cols-2 gap-2 sm:flex sm:items-center sm:justify-end">
              <a class="btn-primary btn-sm text-center" href={`/clasificacion/${l.slug}`}>Clasificaci贸n</a>
              <a class="btn-secondary btn-sm text-center" href={`/liga/${l.slug}`}>Partidos</a>
            </div>
          </li>
        );
      })}
    </ul>
  )}
</Base>


